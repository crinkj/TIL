 # 싱글톤 패턴

> ## 개요
* 싱글턴 패턴은 인스턴스를 하나만 만들어 사용하기 위한 패턴
* 어플리케이션이 시작될 때 어떤 클래스기 최초 한번만 메모리를 할당하고 그 메모리에 인스턴스를 만들어 사용하는 디자인 패턴

> ## 사용 이유?
  * 레지스트릭 같은 설정 파일의 경우 객체가 여러개 생성되면 설정 값이 변경될 위험이 생길 수 있다.
 * 인스턴스가 1개만 생성되는 특징을 가진 싱글턴 패턴을 이용하면, 하나의 신스턴스를 메모리에 등록해서 여러 쓰레드가 동시에 해당 인스턴스를 공유하여 사용할 수 있게끔 할 수 있기 때문에 요청이 많은 곳에서 사용하면 효율을 높일 수 있다.

 > ## 주의
  * 싱글톤을 만들 때 동시성 문제를 고려해서 설계해야 한다
  * 무상태로 설계 해야한다.
    특정 클라이언트에 의존적인 필드가 있으면 안된다.
    특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안된다.
    가급적 읽기만 가능해야 한다.

** <b> [JAVA 예제] </b> ** 
```
public class SingletonClass {
    private static SingletonClass instance; // 1. static으로 선언된 객체를 담는 변수
    
    private SingletonClass() {} // 2. 접근제한자 private 사용으로 외부에서 객체 생성 막음.

    public static SingletonClass getInstance() {
        // 2. 만약 기존에 instance가 생성되어 있었다면 기존 instance를 사용.
            만약 초기화되지 않았다면 새로 생성
        if (instance == null) {
            instance = new SingletonClass();
        }

        return instance; // 3. instance 반환
    }
}
}

```
* 클래스 내에 클래스의 인스턴스를 담는 변수 instance를 선언한다.
* SingletoneClass.getInstance()가 호출된다.
* 만약 instance가 초기화 되지 않았다면 instance를 생성한다.
* 이미 초기화 되어 있다면 아무것도 하지 않는다.
* instance를 반환한다.

** <b>[Kotlin 예제] 에서 object키워드를 이용해 싱글톤 패턴을 간편하게 구현 </b>** 
```
object SingletonClass{
    fun printClass() = println("출력한다 인스턴스: $this")
}

fun main(){
    println("시작")
    SingletonClass.printClass() // (1)
    SingleTonClass.printClass() // (2)
}
```
  #### 출력 결과
 * (1) -> 출력한다 인스턴스: SingletonClass@6ff3c5b5
 * (2) -> 출력한다 인스턴스: SingletonClass@6ff3c5b5


> ## 싱글톤 패턴의 장점 / 단점
* 장점
   * 고정된 메모리 영역을 얻으면서 한번의 new로 인스턴스를 사용하기 때문에 메모리 낭비를 방지싱글톤으로 만들어진 클래스의 인스턴스는 전역이기 때문에 다른 클래스의 인스턴스들이 데이터를 공유하기 쉽다.
   * 인스턴스가 절대적으로 한 개만 존재하는 것을 보장하고 싶을 경우 사용한다.
   * 두 번째 이용시 부터는 객체 로딩 시간이 줄어 성능이 좋아지는 장점이 있다.

* 단점
   * 싱글톤 인스턴스가 너무 많은 일을 하거나 많은 데이터를 공유시킬 경우에 다른 클래스의 인스턴스들간에 결합도가 높아져 “개방 폐쇄 원칙”을 위배하게 된다.
     * 개방 폐쇄 원칙 : 확장에는 열려 있어야 하고, 수정에 대해서는 닫혀 있어야 한다.
  
   * private 생성자를 갖고 있어 상속이 불가능하다.
   * 테스트하기 힘들다
   * 서버 환경에서는 싱글톤이 1개만 생성됨을 보장하지 못한다.
   * 전역 상태를 만들 수 있기 때문에 바람직하지 못하다.
> ## 번외) 스프링 싱글톤 차이
* 스프링은 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공 → 싱글톤 레지스트리
* 스프링 컨테이너는 싱글톤을 생성하고, 관리하고 공급하는 컨테이너
* 싱글톤 레지스트리를 통해 static 메소드나 private를 사용하지 않아 객체지향적 개발을 할 수 있고, 테스트를 하기 편해진다